/*! principalfish 19-07-2024 */
var currentMap,choro={keyOnMap:function(){$("#keyonmap").show();$("#keyonmap").append("<div class='leave'>Leave</div>");for(var t=5;0<t;t--){var e="<div class='choro-minus' style='background-color: "+("rgba(0, 0, 255, "+.2*t+")")+"'>"+(50+3*t).toFixed(1)+"%";5==t&&(e+="+"),e+="</div>",$("#keyonmap").append(e)}for(t=0;t<6;t++){e="<div class='' style='background-color:"+("rgba(255, 215, 0, "+.2*t+")")+"'>"+(50+3*t).toFixed(1)+"%";5==t&&(e+="+"),e+="</div>",$("#keyonmap").append(e)}$("#keyonmap").append("<div class='remain'>Remain</div>")}},partylist={labour:"Labour",conservative:"Conservative",libdems:"Lib Dems",snp:"SNP",ukip:"UKIP",plaidcymru:"Plaid Cymru",green:"Green",uu:"UUP",sinnfein:"Sinn FÃ©in",sdlp:"SDLP",dup:"DUP",alliance:"Alliance",other:"Other",others:"Others",leave:"Leave",remain:"Remain"},regionlist={london:"London",southeastengland:"S.E. England",southwestengland:"S. W. England",westmidlands:"W. Midlands",northwestengland:"N. W. England",northeastengland:"N. E. England",yorkshireandthehumber:"Yorks & Humber",eastmidlands:"E. Midlands",eastofengland:"E. England",scotland:"Scotland",wales:"Wales",northernireland:"N. Ireland",unitedkingdom:"United Kingdom",greatbritain:"Great Britain",england:"England"},regionMap={unitedkingdom:["northeastengland","northwestengland","yorkshireandthehumber","southeastengland","southwestengland","eastofengland","eastmidlands","westmidlands","london","scotland","wales","northernireland"],greatbritain:["northeastengland","northwestengland","yorkshireandthehumber","southeastengland","southwestengland","eastofengland","eastmidlands","westmidlands","london","scotland","wales"],england:["northeastengland","northwestengland","yorkshireandthehumber","southeastengland","southwestengland","eastofengland","eastmidlands","westmidlands","london"]},filters={state:{leave:[0,100]},selectHandle:function(t,e){t=t.substring(7),"null"==e?delete filters.state[t]:"region"==t&&"england"==e?filters.state.region=regionMap.england:filters.state[t]=e,filters.filter()},leave:function(t,e){"low"==t?filters.state.leave[0]=e:"high"==t&&(filters.state.leave[1]=e),filters.filter()},opacities:{},filter:function(){$.each(currentMap.seatData,function(t,n){var e,r=!0;$.each(filters.state,function(t,e){var a;"leave"==t?((a=n.leave)<filters.state.leave[0]||a>filters.state.leave[1])&&(r=!1):"current"==t?n.current!=e&&(r=!1):-1==e.indexOf(n[t])&&(r=!1)}),1==r?(e=currentMap.seatData[t].current,filters.opacities[t]=20/3*(currentMap.seatData[t][e]/100-.5),n.filtered=!0):(filters.opacities[t]=0,n.filtered=!1)}),filters.display()},display:function(){$.each(filters.opacities,function(t,e){t=currentMap.seatData[t].mapSelect;t.opacity=e,d3.select("#i"+t.properties.info_id).attr("opacity",null),d3.select("#i"+t.properties.info_id).attr("fill-opacity",e),0==e&&d3.select("#i"+t.properties.info_id).attr("opacity",.02)}),filters.filteredList=[],$.each(currentMap.seatData,function(t,e){1==e.filtered&&(currentMap.seatData[t].name=t,filters.filteredList.push(currentMap.seatData[t]))}),$("#seatlist-sort"+voteTotals.activeSort).removeClass("sort-active"),voteTotals.activeSort="leave",$("#seatlist-sortleave").addClass("sort-active"),voteTotals.display(filters.filteredList)},reset:function(){filters.state={leave:[0,100]},$("#filter-current option:eq(0)").prop("selected",!0),$("#filter-winner2015 option:eq(0)").prop("selected",!0),$("#filter-region option:eq(0)").prop("selected",!0),$("#filter-leave").get(0).reset(),filters.filter()},filteredList:[]},mapAttr={width:600,height:875,active:d3.select(null),activeNode:null,clicked:function(t){mapAttr.activeNode=t,mapAttr.flashSeat(t);var e=path.bounds(t),a=Math.pow(e[1][0]-e[0][0],.5),n=Math.pow(e[1][1]-e[0][1],.5),r=(e[0][0]+e[1][0])/2,e=(e[0][1]+e[1][1])/2,a=.05/Math.max(a/mapAttr.width,n/mapAttr.height),n=[mapAttr.width/2-a*r,mapAttr.height/2-a*e];mapAttr.disableZoom(),svg.transition().duration(1500).call(zoom.transform,d3.zoomIdentity.translate(n[0],n[1]).scale(a)).on("end",mapAttr.enableZoom),uiAttr.showDiv("seat-information"),seatInfoTable.display(t.properties.name)},flashSeat:function(e){var t="#i"+e.properties.info_id;current=d3.select(t),function t(){current.transition().duration(1500).attr("fill-opacity",.02).transition().duration(1500).attr("fill-opacity",e.opacity).on("end",t)}()},disableZoom:function(){svg.on("mousedown.zoom",null),svg.on("mousemove.zoom",null),svg.on("dblclick.zoom",null),svg.on("touchstart.zoom",null),svg.on("wheel.zoom",null),svg.on("mousewheel.zoom",null),svg.on("MozMousePixelScroll.zoom",null)},enableZoom:function(){svg.call(zoom)},reset:function(){null!=mapAttr.activeNode&&d3.select("#i"+mapAttr.activeNode.properties.info_id).transition().attr("fill-opacity",mapAttr.activeNode.opacity),mapAttr.activeNode=null,mapAttr.disableZoom(),svg.transition().duration(1500).call(zoom.transform,d3.zoomIdentity).on("end",function(){mapAttr.enableZoom()})},zoomed:function(){g.style("stroke-width",1.5/d3.event.scale+"px"),g.attr("transform",d3.event.transform)},stopped:function(){d3.event.defaultPrevented&&d3.event.stopPropagation()},loadmap:function(a){g.selectAll(".map").data(topojson.feature(a.polygons,a.polygons.objects.map).features).enter().append("path").attr("class",function(t){t=t.properties.name in a.seatData?"mapdark "+a.seatData[t.properties.name].current:"map null";return t}).attr("fill-opacity",function(t){var e;return t.properties.name in currentMap.seatData?(e=a.seatData[t.properties.name].current,e=20/3*(a.seatData[t.properties.name][e]/100-.5),a.seatData[t.properties.name].mapSelect=t,a.seatData[t.properties.name].mapSelect.opacity=e):0}).attr("id",function(t){return"i"+t.properties.info_id}).attr("d",path).on("click",mapAttr.clicked).append("svg:title").text(function(t){return t.properties.name}).each(function(t){t.properties.name in currentMap.seatData&&(a.seatData[t.properties.name].filtered=!0)}),g.append("path").datum(topojson.mesh(a.polygons,a.polygons.objects.map,function(t,e){return t.properties.region!=e.properties.region&&t!=e})).attr("d",path).attr("class","boundaries")}},projection=d3.geoAlbers().center([-.5,54.4]).rotate([2.25,0]).parallels([51,60]).scale(5300).translate([mapAttr.width/2,mapAttr.height/2]),path=d3.geoPath().projection(projection),zoom=d3.zoom().scaleExtent([1,8]).on("zoom",mapAttr.zoomed);function getData(e){$.when($.getJSON(e.mapurl,function(t){e.polygons=t}),$.getJSON(e.dataurl,function(t){e.seatData=t,currentMap=e})).then(function(){pageLoadEssentials()})}function pageLoadEssentials(){mapAttr.loadmap(currentMap),filters.opacities={},filters.reset(),choro.keyOnMap();var t=Object.keys(currentMap.seatData);t.sort(),$(function(){$("#searchseats").autocomplete({source:t,select:function(t,e){searchSeats(e.item.label)}})}),uiAttr.pageLoadDiv(),-1<navigator.userAgent.toLowerCase().indexOf("firefox")&&($("div").css("font-size","98%"),$("select").css("font-size","98%"))}function searchSeats(t){mapAttr.clicked(currentMap.seatData[t].mapSelect)}function pageSetting(t,e,a,n,r,i){this.name=t,this.mapurl=e,this.dataurl=a,this.previous=n,this.election=r,this.predict=i,this.seatData={},this.polygons={}}var dataurls={map650:"650seat_no_ni.json",brexit:"houseofcommons/brexit.json"},brexit=new pageSetting("brexit",dataurls.map650,dataurls.brexit,dataurls.brexit,!1,!1);function initialization(){var t=brexit;uiAttr.changeNavBar(t.name),$(document).ready(function(){getData(t)})}var seatInfoTable={party:null,display:function(t){var e=currentMap.seatData[t],a=[{party:"remain",percent:e.remain},{party:"leave",percent:e.leave}];a.sort(function(t,e){return e.percent-t.percent}),seatInfoTable.seatInfo(t,e),seatInfoTable.voteTable(a),seatInfoTable.barChart(a)},seatInfo:function(t,e){$("#information-party .party-flair").removeClass(seatInfoTable.party),$("#information-seatname-span").text(t),$("#information-region").text(regionlist[e.region]),$("#information-party .party-name").text(partylist[e.winner2015]),$("#information-party .party-flair").addClass(e.winner2015),$("#information-majority").text(""),$("#information-turnout").text(""),seatInfoTable.party=e.winner2015},barChart:function(t){$("#information-bar").empty();var e=t.length,a=10,n=0,r=10,i=25,o=200-i-n,s=200-a-r,l=d3.min([90,o/e-2]),o=d3.select("#information-bar").append("svg").attr("width",o+i+n).attr("height",s+a+r).append("g").attr("transform","translate("+i+","+a+")"),n=d3.scaleOrdinal().range([0,e*(l+2)]),r=d3.axisBottom().scale(n),d=d3.scaleLinear().range([s,0]),i=d3.axisLeft().scale(d).ticks(6),a=d3.max(t,function(t){return+t.percent});d.domain([0,d3.max([60,a+(10-a%10)])]),o.append("g").attr("class","x axis").attr("transform","translate(0,"+s+")").call(r),o.append("g").attr("class","y axis").call(i),o.selectAll("rect").data(t).enter().append("rect").attr("x",function(t,e){return 2*(e+1)+l*e}).attr("width",l).attr("y",s).attr("height",0).attr("class",function(t){return t.party}).transition().delay(function(t,e){return 250*e/2}).duration(250).attr("y",function(t){return d(t.percent)}).attr("height",function(t){return s-d(t.percent)})},voteTable:function(t){$("#information-chart").empty();for(var e=0;e<t.length;e++){var a="<div class='party-info-table'>",a=(a=(a+="<div class='party-flair "+t[e].party+"'></div>")+("<div>"+partylist[t[e].party]+"</div>"))+("<div>"+t[e].percent.toFixed(2)+"%</div>")+"</div>";$("#information-chart").append(a)}}},uiAttr={changeNavBar:function(t){$(".navbaractive").removeClass("navbaractive");t="#nav-"+t,$(t).addClass("navbaractive"),t=$(t).text();$("#pagetitle").html(t),document.title=t},clickMapButton:function(t){var e=$(t).attr("class"),a=$(t).attr("id");-1==e.indexOf("mapbuttonactive")?($(t).addClass("mapbuttonactive"),uiAttr.showDiv(a)):uiAttr.hideDiv(a)},showDiv:function(t){uiAttr.zIndexCheck(t),$(uiAttr.buttonToDiv[t]).show(),$(uiAttr.buttonToDiv[t]).mousedown(function(){uiAttr.zIndexCheck(t),uiAttr.zIndexShuffle()}).draggable({handle:"h2",containment:"#wrapper"}),uiAttr.zIndexShuffle()},hideDiv:function(t){var e=uiAttr.zIndexTracker.indexOf(t);$("#"+t).removeClass("mapbuttonactive"),-1!=e&&uiAttr.zIndexTracker.splice(e,1),$(uiAttr.buttonToDiv[t]).hide(),uiAttr.zIndexShuffle()},buttonToDiv:{brexitvotesbutton:"#brexitvotes","seat-information":"#seat-information",votetotalsbutton:"#votetotals",filtersbutton:"#filters",choroplethsbutton:"#choropleths",seatlistbutton:"#seatlist","seatlist-extend":"#seatlist-extended",predictbutton:"#userinput","seat-600":"#seat-600"},zIndexTracker:[],zIndexCheck:function(t){var e,a;-1==uiAttr.zIndexTracker.indexOf(t)?uiAttr.zIndexTracker.push(t):(e=uiAttr.zIndexTracker.indexOf(t),a=uiAttr.zIndexTracker.length-1,uiAttr.zIndexTracker.splice(e,1),uiAttr.zIndexTracker.splice(a,0,t))},zIndexShuffle:function(){for(var t=uiAttr.zIndexTracker,e=0;e<t.length;e++)$(uiAttr.buttonToDiv[t[e]]).css("z-index",e+1)},pageLoadDiv:function(){$.each(uiAttr.buttonToDiv,function(t,e){"brexitvotesbutton"==t||"filtersbutton"==t?uiAttr.showDiv(t):"predictbutton"==t&&1==currentMap.predict?($("#predictbutton").removeClass("hidden").addClass("mapbuttonactive"),uiAttr.showDiv(t)):uiAttr.hideDiv(t)})}};voteTotals={display:function(t){voteTotals.sortState={name:"asc",region:"asc",leave:"desc",remain:"desc"},voteTotals.reorder("leave","desc")},activeSort:"leave",sortState:{},tableSort:function(t){t=t.slice(13),$("#seatlist-sort"+voteTotals.activeSort).removeClass("sort-active"),voteTotals.activeSort=t,$("#seatlist-sort"+voteTotals.activeSort).addClass("sort-active"),voteTotals.reorder(t,voteTotals.sortState[t]),"desc"==voteTotals.sortState[t]?voteTotals.sortState[t]="asc":"asc"==voteTotals.sortState[t]&&(voteTotals.sortState[t]="desc")},reorder:function(a,t){var e=filters.filteredList.map(function(t,e){return{ind:e,data:t}});"asc"==t&&e.sort(function(t,e){return t.data[a]<e.data[a]?-1:t.data[a]>e.data[a]?1:t.ind-e.ind}),"desc"==t&&e.sort(function(t,e){return t.data[a]<e.data[a]?1:t.data[a]>e.data[a]?-1:t.ind-e.ind}),filters.filteredList=e.map(function(t){return t.data}),voteTotals.extendedList()},seatTotals:function(){$("#brexitvotes-seatnumbers").empty();var t=filters.filteredList.length,a=0,n=0,t=($.each(filters.filteredList,function(t,e){"leave"==e.current?n+=1:a+=1}),"<p style='font-weight: bold'>Total : "+t+" &nbsp;Remain <span class='party-flair remain'></span>: "+a+"&nbsp; Leave <span class='party-flair leave'></span>: "+n+"</p>");$("#brexitvotes-seatnumbers").append(t)},extendedList:function(){voteTotals.seatTotals(),$("#brexitvotes-data").empty(),$.each(filters.filteredList,function(t,e){var a=e.name,n="<div style='margin-left: 10px' class='party-flair "+e.current+"'></div>",r="<div style='margin-left: 10px'>"+regionlist[e.region]+"</div>",i="<div style='margin-left: 10px' class='party-flair "+e.winner2015+"'></div>",o="<div style='margin-left: 10px'>"+e.leave.toFixed(2)+"</div>",s="<div style='margin-left: 10px'>"+e.remain.toFixed(2)+"</div>",l="</div><div>",e="<div><div class='extended-seat' onclick='mapAttr.clicked(currentMap.seatData[\""+e.name+"\"].mapSelect)'>"+a+l+r+l+n+l+i+l+o+l+s+"</div></div>";$("#brexitvotes-data").append(e)})}};