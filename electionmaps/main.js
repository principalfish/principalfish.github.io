/*! principalfish.github.io 21-02-2017 */
function choroplethInitiator(a,b){if("null"==a)$.each(seatData,function(a){seatData[a].seat_info.current_colour=1}),$(".map").remove(),$("#keyonmap").html(""),loadmap();else if(filteredSeatsTotal>0)if("swing"!=b||"null"!=swingState[0]&&"null"!=swingState[1]){maxMin=getChoroplethMaxMin(a,b);var c=maxMin[0],d=maxMin[1];generateChoropleth(a,b,c,d)}else;}function getChoroplethMaxMin(a,b){var c=[];$.each(seatDataForChoropleth,function(d){var e;"percent"==b||"change"==b?a in seatDataForChoropleth[d].party_info&&(e=seatDataForChoropleth[d].party_info[a][b]):"swing"==b&&a[0]in seatDataForChoropleth[d].party_info&&a[1]in seatDataForChoropleth[d].party_info&&(e=(seatDataForChoropleth[d].party_info[a[1]].change-seatDataForChoropleth[d].party_info[a[0]].change)/2),void 0!=e&&c.push(e)});var d=Math.max.apply(Math,c),e=Math.min.apply(Math,c);if("change"==b||"swing"==b)var d=Math.max(Math.abs(d),Math.abs(e)),e=-d;return"percent"==b&&d>60&&(d=60),[d,e]}function generateChoropleth(a,b,c,d){var e,f=c-d;if("percent"==b){var g="."+a;choroplethColour=$(g).css("background-color"),e=$(g).css("color")}else"change"==b||"swing"==b?(choroplethColour="rgb(0, 0, 255)",e="white"):(choroplethColour="rgb(255, 0, 0)",e="white");$.each(seatDataForChoropleth,function(e){var g=seatDataForChoropleth[e].seat_info.info_id,e=seatsFromIDs[g],h=getChoroplethOpacity(a,b,c,d,f,seatsFromIDs[g],choroplethColour),i=h[0],j=h[1];d3.select(g).style("fill",i).attr("opacity",j)}),keyOnMap(a,b,c,d,f,choroplethColour,e)}function getChoroplethOpacity(a,b,c,d,e,f,g){var h,i;if("percent"==b||"change"==b){if(!(a in seatDataForChoropleth[f].party_info))return[null,0];i=seatDataForChoropleth[f].party_info[a][b],"change"==b&&0>i&&(g="red"),"percent"==b?(h=(i-d)/e,seatData[f].seat_info.current_colour=h):"change"==b&&(h=Math.abs(i/c))}else if("swing"==b){if(!(a[0]in seatDataForChoropleth[f].party_info&&a[1]in seatDataForChoropleth[f].party_info))return[null,0];i=(seatDataForChoropleth[f].party_info[a[1]].change-seatDataForChoropleth[f].party_info[a[0]].change)/2,"swing"==b&&0>i&&(g="red"),h=Math.abs(i/c)}return seatData[f].seat_info.current_colour=h,[g,h]}function keyOnMap(a,b,c,d,e,f,g){$("#keyonmap").html("");var h;if("percent"==b&&(h=partylist[a]+" Vote Share"),"change"==b&&(h=partylist[a]+" Vote Share Change"),"swing"==b&&(h="Swing between "+partylist[a[0]]+" and "+partylist[a[1]]),$("#maptitletext").text(h),$("#maptitle").show(),"null"==a);else{for(var i=e/5,j={},k=0;6>k;k++){var l=d+i*k,m=(l-d)/e;("change"==b||"swing"==b)&&(l=c-c/5*k,m=l/c),l=["percent","change","swing"].indexOf(b)>-1?l.toFixed(1):l.toFixed(0),"percent"==b&&60==l&&(l+="+"),j[l]=m}var n;if(n=["percent","change","swing"].indexOf(b)>-1?"%":"",$.each(j,function(a){var b=f.replace(")",","+j[a]+")").replace("rgb","rgba");$("#keyonmap").append('<div style=" color:'+g+"; text-align: center; background-color: "+b+'">'+a+n+"</div>")}),"change"==b||"swing"==b){for(var j={},k=1;6>k;k++){var l=c/5*k,m=l/c;l=l.toFixed(1),j[l]=m}$.each(j,function(a){$("#keyonmap").append('<div style="text-align: center; background-color: rgba(255, 0, 0, '+j[a]+'); color: white;">-'+a+"%</div>")})}}}function filterMap(){filteredSeatsTotal=0,d3.selectAll(".map").attr("opacity",1),$("#keyonmap").html(""),$("#seat-information").hide(),$("#maptitle").hide(),$("#votesharebypartyselect option:eq(0)").prop("selected",!0),$("#votesharechangebypartyselect option:eq(0)").prop("selected",!0),$("#swingfrom option:eq(0)").prop("selected",!0),$("#swingto option:eq(0)").prop("selected",!0),swingState=["null","null"];var a=filterStates[0].party,b=filterStates[1].gain,c=filterStates[2].region,d=filterStates[3].majoritylow,e=filterStates[4].majorityhigh;isNaN(d)&&(d=0),isNaN(e)&&(e=100),seatsAfterFilter=[],seatDataForChoropleth={},g.selectAll(".map").attr("id","filtertime"),"null"==a?g.selectAll("#filtertime").attr("id","partyfiltered"):g.selectAll("#filtertime").attr("style",function(b){return a!=seatData[b.properties.name].seat_info.winning_party?"opacity: 0.02":void 0}).attr("id",function(b){return a==seatData[b.properties.name].seat_info.winning_party?"partyfiltered":void 0}),"null"==b?g.selectAll("#partyfiltered").attr("id","gainfiltered"):("gain"==b&&g.selectAll("#partyfiltered").attr("style",function(a){return"hold"==seatData[a.properties.name].seat_info.change?"opacity: 0.02":void 0}).attr("id",function(a){return"gain"==seatData[a.properties.name].seat_info.change?"gainfiltered":void 0}),"hold"==b&&g.selectAll("#partyfiltered").attr("style",function(a){return"gain"==seatData[a.properties.name].seat_info.change?"opacity: 0.02":void 0}).attr("id",function(a){return"hold"==seatData[a.properties.name].seat_info.change?"gainfiltered":void 0})),"null"==c?g.selectAll("#gainfiltered").attr("id","regionfiltered"):g.selectAll("#gainfiltered").attr("style",function(a){return c!=seatData[a.properties.name].seat_info.area?"opacity: 0.02":void 0}).attr("id",function(a){return c==seatData[a.properties.name].seat_info.area?"regionfiltered":void 0}),g.selectAll("#regionfiltered").attr("style",function(a){return parseFloat(seatData[a.properties.name].seat_info.maj_percent)<d||parseFloat(seatData[a.properties.name].seat_info.maj_percent)>e?"opacity: 0.02":void 0}).each(function(a){parseFloat(seatData[a.properties.name].seat_info.maj_percent)>=d&&parseFloat(seatData[a.properties.name].seat_info.maj_percent)<=e&&seatsAfterFilter.push(a),seatDataForChoropleth[a.properties.name]=seatData[a.properties.name],filteredSeatsTotal+=1}),g.selectAll(".map").attr("id",function(a){return"i"+a.properties.info_id}),generateSeatList(),$(seatTotalContainer).html(" "),$(seatListContainer).html(" ")}function resetFilter(){filterStates[0].party="null",filterStates[1].gain="null",filterStates[2].region="null",filterStates[3].majoritylow=0,filterStates[4].majorityhigh=100;swingState=["null","null"],partyVoteShare="null",partyVoteShareChange="null",filterMap(),$.each(seatData,function(a){seatData[a].seat_info.current_colour=1}),$("#votesharebypartyselect option:eq(0)").prop("selected",!0),$("#votesharechangebypartyselect option:eq(0)").prop("selected",!0),$("#swingfrom option:eq(0)").prop("selected",!0),$("#swingto option:eq(0)").prop("selected",!0),$("#dropdownparty option:eq(0)").prop("selected",!0),$("#dropdowngains option:eq(0)").prop("selected",!0),$("#dropdownregion option:eq(0)").prop("selected",!0),$("#majority").get(0).reset(),$(seatTotalContainer).html(" "),$(seatListContainer).html(" ")}function generateSeatList(){seatsAfterFilter.sort(function(a,b){var c=a.properties.name.toLowerCase(),d=b.properties.name.toLowerCase();return d>c?-1:c>d?1:0}),$("#totalfilteredseats").html(" "),$("#filteredlisttable").html(" "),$(seatTotalContainer).html(" "),$(seatListContainer).html(" "),$(seatTotalContainer).append("<p>Total : "+seatsAfterFilter.length+"</p>"),$.each(seatsAfterFilter,function(a){"gain"==filterStates[1].gain&&"null"!=filterStates[0].party?$(seatListContainer).append('<div onclick="zoomToClickedFilteredSeat(seatsAfterFilter['+a+'])"><div class="party-flair '+seatData[seatsAfterFilter[a].properties.name].seat_info.incumbent+'"></div>'+seatsAfterFilter[a].properties.name+"</div>"):$(seatListContainer).append('<div onclick="zoomToClickedFilteredSeat(seatsAfterFilter['+a+'])"><div class="party-flair '+seatData[seatsAfterFilter[a].properties.name].seat_info.winning_party+'"></div>'+seatsAfterFilter[a].properties.name+"</div>")})}function searchSeats(a){$.each(searchSeatData,function(b){searchSeatData[b].properties.name==a&&zoomToClickedFilteredSeat(searchSeatData[b])})}function getData(a){return $.ajax({cache:!0,dataType:"json",url:a,type:"GET"})}function getSeatInfo(a){$.each(a,function(b){seatData[b]=a[b],totalElectorate+=a[b].seat_info.electorate;var c=seatData[b].seat_info.incumbent;("independent"==c||"speaker"==c||"respect"==c)&&(seatData[b].seat_info.incumbent="other")}),loadmap(),areas=regions.england.concat(regions.scotland).concat(regions.wales).concat(regions.northernireland),getVoteTotals("all"),getVoteTotals("greatbritain"),getVoteTotals("england");for(area in areas)getVoteTotals(areas[area]);displayVoteTotals(nationalVoteTotals);var b=100*nationalVoteTotals[nationalVoteTotals.length-1].votes/totalElectorate;isNaN(b)&&(b=100),b="Turnout : "+String(b.toFixed(2))+"%",document.getElementById("totalturnout").innerHTML=b}function showSeatList(a){$("#polltablebody").html(""),$(function(){$("#seatlist").load("seatlists/seatlist"+a+".html")}),$("#seatlist").show(),currentZindex+=1,$("#seatlist").css("z-index",currentZindex)}function showMethodology(){$("#methodology").html(""),$(function(){$("#methodology").load("methodology.html")}),$("#methodology").show(),currentZindex+=1,$("#methodology").css("z-index",currentZindex)}function showUserInput(){$("#userinput").html(""),$(function(){$("#userinput").load("userinput.html")}),$("#userinput").show(),$("#userinput").draggable(),currentZindex+=1,$("#userinput").css("z-index",currentZindex)}function loadTheMap(a){seatData={},seatsAfterFilter=[],seatNames=[],searchSeatData=[],totalElectorate=0,$(".map").remove(),$(document).ready(function(){getData("data/"+a+"/info.json").done(getSeatInfo)})}function alterTheUI(a){pageSetting=a,resetFilter(),$("#selectareatotals option:eq(0)").prop("selected",!0);var b="#nav"+previousSetting,c="#nav"+pageSetting;$(b).attr("class","notactive"),$(c).attr("class","currentpage"),"2016parliament"==a&&($("title").text("UK Election Maps - Current Parliament"),$("#headertitle").text("Current Parliament"),$("#dropdowngainslabel").show(),$("#dropdowngains").show(),$("#swingfromto").show(),$("#votesharechangebyparty").show(),$("#navseatlist").show(),$("#navprojectionmethodology").hide(),$("#navprojectionuserinput").hide(),$("#userinput").hide()),"2015parliament"==a&&($("title").text("UK Election Maps - 2015 Parliament"),$("#headertitle").text("2015 Parliament"),$("#dropdowngainslabel").show(),$("#dropdowngains").show(),$("#swingfromto").show(),$("#votesharechangebyparty").show(),$("#navseatlist").show(),$("#navprojectionmethodology").hide(),$("#navprojectionuserinput").hide(),$("#userinput").hide()),"2010parliament"==a&&($("title").text("UK Election Maps - 2010 Parliament"),$("#headertitle").text("2010 Parliament"),$("#dropdowngainslabel").hide(),$("#dropdowngains").hide(),$("#swingfromto").hide(),$("#votesharechangebyparty").hide(),$("#navseatlist").hide(),$("#navprojectionmethodology").hide(),$("#navprojectionuserinput").hide(),$("#userinput").hide()),"2015projection"==a&&($("title").text("UK Election Maps - 2015 Projection"),$("#headertitle").text("2015 Projection"),$("#dropdowngainslabel").show(),$("#dropdowngains").show(),$("#swingfromto").show(),$("#votesharechangebyparty").show(),$("#navseatlist").show(),$("#navprojectionmethodology").show(),$("#navprojectionuserinput").hide(),$("#userinput").hide()),"2020projection"==a&&($("title").text("UK Election Maps - 2020 Projection"),$("#headertitle").text("2020 Projection"),$("#dropdowngainslabel").show(),$("#dropdowngains").show(),$("#swingfromto").show(),$("#votesharechangebyparty").show(),$("#navseatlist").show(),$("#navprojectionmethodology").show(),$("#navprojectionuserinput").show(),previousYear=String(parseInt(pageSetting.slice(0,4)-5)),getData("data/"+previousYear+"parliament/info.json").done(getOldInfo)),previousSetting=a}function zoomToClickedFilteredSeat(a){var b="#i"+a.properties.info_id;if(void 0!=previousnode){var c=seatsFromIDs[previousnode];previous_opacity=seatData[c].seat_info.current_colour}void 0==previous_opacity&&(previous_opacity=1);var d=seatsFromIDs[b];current_colour=seatData[d].seat_info.current_colour,void 0==current_colour&&(current_colour=1),previous=d3.select(previousnode),current=d3.select(b),flashSeat(previous,current,previous_opacity,current_colour);var e=path.bounds(a),f=Math.pow(e[1][0]-e[0][0],.5),g=Math.pow(e[1][1]-e[0][1],.5),h=(e[0][0]+e[1][0])/2,i=(e[0][1]+e[1][1])/2,j=.025/Math.max(f/width,g/height),k=[width/2-j*h,height/3-j*i];disableZoom(),svg.transition().duration(1500).call(zoom.translate(k).scale(j).event).each("end",enableZoom),$("#seat-information").show(),seatinfo(a),previousnode=b}function flashSeat(a,b,c,d){function e(){void 0!=b&&b.transition().duration(1500).attr("opacity",.02).transition().duration(1500).attr("opacity",d).each("end",e)}a.transition().attr("opacity",c),e()}function disableZoom(){svg.on("mousedown.zoom",null),svg.on("mousemove.zoom",null),svg.on("dblclick.zoom",null),svg.on("touchstart.zoom",null),svg.on("wheel.zoom",null),svg.on("mousewheel.zoom",null),svg.on("MozMousePixelScroll.zoom",null)}function enableZoom(){svg.call(zoom)}function reset(){$("#seat-information").is(":visible")&&$("#seat-information").hide(),disableZoom(),svg.transition().duration(1500).call(zoom.translate([0,0]).scale(1).event).each("end",enableZoom)}function zoomed(){g.style("stroke-width",1.5/d3.event.scale+"px"),g.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")}function stopped(){d3.event.defaultPrevented&&d3.event.stopPropagation()}function loadmap(){d3.json("data/map.json",function(a,b){return a?console.error(a):(g.selectAll(".map").data(topojson.feature(b,b.objects.map).features).enter().append("path").attr("class",function(a){return seatname=a.properties.name,seatname in seatData?(seatParty=seatData[seatname].seat_info.winning_party,"map "+seatParty):"not_here"}).attr("opacity",1).attr("id",function(a){return"i"+a.properties.info_id}).attr("d",path).on("click",zoomToClickedFilteredSeat).append("svg:title").text(function(a){return a.properties.name}).each(function(a){searchSeatData.push(a),seatNames.push(a.properties.name),seatsFromIDs["#i"+a.properties.info_id]=a.properties.name,seatData[a.properties.name].seat_info.info_id="#i"+a.properties.info_id,a.properties.name in seatData&&(seatsAfterFilter.push(a),seatDataForChoropleth[a.properties.name]=seatData[a.properties.name])}),void g.append("path").datum(topojson.mesh(b,b.objects.map,function(a,b){return seatData[a.properties.name].seat_info.area!=seatData[b.properties.name].seat_info.area&&a!=b})).attr("d",path).attr("class","boundaries"))})}function seatinfo(a){var b=seatData[a.properties.name].seat_info;$(partyFlairElement).removeClass(oldPartyClass),$(gainFlairElement).removeClass(oldIncumbentClass),seatTitle=a.properties.name,void 0!=seatData[a.properties.name].seat_info.by_election&&(seatTitle+="*"),$("#information-seatname-span").text(seatTitle),$("#information-region").text("Region: "+regionlist[b.area]),$(partyNameElement).text("Party: "+partylist[b.winning_party]),$(partyFlairElement).addClass(b.winning_party),b.winning_party!=b.incumbent?($(gainNameElement).text("Gain from "+partylist[b.incumbent]),$(gainFlairElement).addClass(b.incumbent)):$(gainNameElement).text(""),$("#information-majority").text("Majority: "+b.maj_percent+" % = "+b.maj);var c=(100*b.turnout/b.electorate).toFixed(2)+"%";$("#information-turnout").text("Turnout : "+c),$("#information-pie").html(piechart(a)),oldPartyClass=b.winning_party,oldIncumbentClass=b.incumbent}function piechart(a){$("#information-pie").empty(),$("#information-chart").empty(),$("#information-chart").html("<table></table>");var b=[],c=seatData[a.properties.name].party_info;$.each(c,function(a){votes=c[a].percent,votes>0&&b.push({party:a,votes:votes,vote_change:c[a].change})});var d=[];$.each(b,function(a){b[a].votes>0&&"others"!=b[a].party&&d.push(b[a])}),d.sort(function(a,b){return b.votes-a.votes});var e=Object.keys(c);-1!=e.indexOf("others")&&c.others.percent>0&&d.push({party:"others",votes:c.others.percent,vote_change:c.others.change});var f=[];$.each(d,function(a){d[a].votes>=3&&f.push(d[a])});var g=f.length,h={top:10,right:0,bottom:10,left:25},i=250-h.left-h.right,j=225-h.top-h.bottom,k=2,l=d3.min([60,i/g-k]),m=250,n=d3.select("#information-pie").append("svg").attr("width",i+h.left+h.right).attr("height",j+h.top+h.bottom).append("g").attr("transform","translate("+h.left+","+h.top+")"),o=d3.scale.ordinal().range([0,g*(l+2)]),p=d3.svg.axis().scale(o).orient("bottom"),q=d3.scale.linear().range([j,0]),r=d3.svg.axis().scale(q).orient("left").ticks(6),s=d3.max(f,function(a){return a.votes});q.domain([0,d3.max([60,s+(10-s%10)])]),n.append("g").attr("class","x axis").attr("transform","translate(0,"+j+")").call(p),n.append("g").attr("class","y axis").call(r),n.selectAll("rect").data(f).enter().append("rect").attr("x",function(a,b){return k*(b+1)+l*b}).attr("width",l).attr("y",j).attr("height",0).attr("class",function(a){return a.party}).transition().delay(function(a,b){return b*m/2}).duration(m).attr("y",function(a){return q(a.votes)}).attr("height",function(a){return j-q(a.votes)}),$.each(d,function(b){var c="";d[b].vote_change>0&&(c="+");var e;e=""==d[b].vote_change?"":parseFloat(d[b].vote_change).toFixed(2);var f='<tr><td><div class= " party-flair '+d[b].party+'"></div><td style="max-width: 170px;">'+seatData[a.properties.name].party_info[d[b].party].name+"</td><td>"+parseFloat(d[b].votes).toFixed(2)+"%</td>";f+="2010parliament"==pageSetting?"</tr>":"<td>"+c+e+"</td></tr>",$("#information-chart table").append(f)}),null!=seatData[a.properties.name].seat_info.byelection&&$("#information-byelection").text("By-election since "+pageSetting.slice(0,4)),null!=seatData[a.properties.name].seat_info.by_election?$("#information-byelection").text("*By-election on "+seatData[a.properties.name].seat_info.by_election):$("#information-byelection").text("")}function getOldInfo(a){$.each(a,function(b){var c={},d=0;$.each(parties,function(e){var f=parties[e];void 0!=a[b].party_info[f]&&("other"==f||"others"==f?d+=a[b].party_info[f].percent:c[f]=a[b].party_info[f].percent)}),oldSeatData[b]=c,oldSeatData[b].other=d,oldSeatData[b].area=a[b].seat_info.area,oldSeatData[b].incumbent=a[b].seat_info.winning_party})}function userInputCheck(a,b){var c=sumFormPercentages(a).toFixed(0);spanId="#other"+b,0>c?$(spanId).html("< 0"):$(spanId).html(c)}function sumFormPercentages(a){var b=$(a),c=b.find(".inputnumbers"),d=0;c.each(function(){var a=Number($(this).val());isNaN(a)&&(a=0),d+=a});var e=100-d;return e}function analyseUserInput(a,b){var c=sumFormPercentages(a);if(0>c)alert("Percentages add up to more than 100, try again.");else{if("england"==b){$.each(englandUserNumbers,function(a){isNaN(englandUserNumbers[a])&&(englandUserNumbers[a]=0)}),englandUserNumbers.other=100-englandUserNumbers.labour-englandUserNumbers.conservative-englandUserNumbers.libdems-englandUserNumbers.ukip-englandUserNumbers.green;var d=englandUserNumbers}if("scotland"==b){$.each(scotlandUserNumbers,function(a){isNaN(scotlandUserNumbers[a])&&(scotlandUserNumbers[a]=0)}),scotlandUserNumbers.other=100-scotlandUserNumbers.labour-scotlandUserNumbers.conservative-scotlandUserNumbers.libdems-scotlandUserNumbers.ukip-scotlandUserNumbers.green-scotlandUserNumbers.snp;var d=scotlandUserNumbers}if("wales"==b){$.each(walesUserNumbers,function(a){isNaN(walesUserNumbers[a])&&(walesUserNumbers[a]=0)}),walesUserNumbers.other=100-walesUserNumbers.labour-walesUserNumbers.conservative-walesUserNumbers.libdems-walesUserNumbers.ukip-walesUserNumbers.green-walesUserNumbers.plaidcymru;var d=walesUserNumbers}if("northernireland"==b){$.each(northernirelandUserNumbers,function(a){isNaN(northernirelandUserNumbers[a])&&(northernirelandUserNumbers[a]=0)}),northernirelandUserNumbers.other=100-northernirelandUserNumbers.dup-northernirelandUserNumbers.sdlp-northernirelandUserNumbers.sinnfein-northernirelandUserNumbers.uu-northernirelandUserNumbers.alliance;var d=northernirelandUserNumbers}projection_getChange(d,b),alterMap(b)}}function projection_getChange(a,b){var c={},d={};for(party in a){var e=previousTotalsByYearByParty[previousYear][b][party],f=previousTotalsByYearByParty[previousYear][b].turnout,g=100*parseFloat(e)/f;c[party]=a[party]-g}for(area in regions[b]){var h={};k=0;for(party in a){var i=100*previousTotalsByYearByParty[previousYear][regions[b][area]][party]/parseFloat(previousTotalsByYearByParty[year][regions[b][area]].turnout),j=i+c[party];0>=j&&(j=0),h[party]=j}var k=0;for(party in h)k+=h[party];var l=k/100;for(party in h)h[party]/=l;d[regions[b][area]]=h}projection_getRegionalChange(b,a,d)}function projection_getRegionalChange(a,b,c){var d={},e={};for(area in regions[a]){var f={},g={};for(party in b){var h=100*previousTotalsByYearByParty[previousYear][regions[a][area]][party]/parseFloat(previousTotalsByYearByParty[year][regions[a][area]].turnout);g[party]=h;var i=c[regions[a][area]][party]/h;f[party]=i}e[regions[a][area]]=g,d[regions[a][area]]=f}projection_seatAnalysis(a,b,d,e)}function projection_seatAnalysis(a,b,c,d){for(area in regions[a])for(seat in seatData)if(oldSeatData[seat].area==regions[a][area]){var e={};for(party in b){var f=oldSeatData[seat][party],g=d[regions[a][area]][party],h=f/g;if(0==h)e[party]=0;else{var i=c[regions[a][area]][party]-1,j=1+i/Math.sqrt(h);.15>j&&(j=.15);var k=j*oldSeatData[seat][party];oldSeatData[seat].incumbent==party&&("conservative"==party&&(k+=2),"libdems"==party&&(k+=4),"ukip"==party&&(k+=8),"green"==party&&(k+=8),"labour"==party&&(k+=1),"snp"==party&&(k+=0),"plaidcymru"==party&&(k+=4)),isNaN(k)&&(k=0),e[party]=k}}var l=0;for(party in e)l+=e[party];var m=l/100;for(party in e)e[party]/=m;var n=[];for(party in e)n.push([party,e[party]]);n.sort(function(a,b){return a[1]-b[1]});var o,p=n.pop(),q=n.pop(),r=p[0],s=p[1]-q[1];o=p==seatData[seat].incumbent?"hold":"gain",seatData[seat].seat_info.change=o,seatData[seat].seat_info.winning_party=r,seatData[seat].seat_info.maj=parseInt(s*seatData[seat].seat_info.turnout/100),seatData[seat].seat_info.maj_percent=parseFloat(s.toFixed(2));for(party in e)if(e[party]>0){var t=e[party]-oldSeatData[seat][party],u=e[party],v=e[party]*seatData[seat].seat_info.turnout/100;seatData[seat].party_info[party].change=parseFloat(t.toFixed(2)),seatData[seat].party_info[party].percent=parseFloat(u.toFixed(2)),seatData[seat].party_info[party].total=parseInt(v)}}}function alterMap(a){seatsAfterFilter=[],totalElectorate=0,$(".map").remove(),getSeatInfo(seatData)}function resetInputs(){$("#englandinput").get(0).reset(),$("#scotlandinput").get(0).reset(),$("#walesinput").get(0).reset(),$("#northernirelandinput").get(0).reset(),$("#otherengland").text("100"),$("#otherscotland").text("100"),$("#otherwales").text("100"),$("#othernorthernireland").text("100"),englandUserNumbers={conservative:0,labour:0,libdems:0,ukip:0,green:0},scotlandUserNumbers={conservative:0,labour:0,libdems:0,ukip:0,green:0,snp:0},walesUserNumbers={conservative:0,labour:0,libdems:0,ukip:0,green:0,plaidcymru:0},northernirelandUserNumbers={dup:0,sinnfein:0,sdlp:0,uu:0,alliance:0},loadTheMap(pageSetting)}function displayVoteTotals(a){$("#totalstable").remove();var b='<table id="totalstable" class="tablesorter"><thead><tr><th>Party</th><th class="tablesorter-header">Seats</th>';simpleTables=["2010parliament","2016parliament"],b+=simpleTables.indexOf(pageSetting)>=0?'<th class="tablesorter-header">Votes</th><th class="tablesorter-header">Vote %</th></tr></thead><tbody id="totalstableinfo"></tbody><tfoot id="totalstablefoot"></tfoot></table>':'<th class="tablesorter-header">Change</th><th class="tablesorter-header">Votes</th><th class="tablesorter-header">Vote %</th>	<th class="tablesorter-header">% +/-</th></tr></thead><tbody id="totalstableinfo"></tbody><tfoot id="totalstablefoot"></tfoot></table>',$("#totalstablediv").append(b);var c,d,e;$.each(a,function(b){if(d=a[b].change>0?"+":"",e=a[b].percentchange>0?"+":"",c=void 0==a[b].percentchange?"":a[b].percentchange.toFixed(2),b==a.length-1){var f='<tr style="text-align: center;" class="'+a[b].code+'"><td style="text-align: left;">'+partylist[a[b].code]+'</td><td style="text-align: right;">'+a[b].seats+"</td>";f+=simpleTables.indexOf(pageSetting)>=0?'<td style="text-align: right;">'+a[b].votes.toLocaleString()+"</td><td></td></tr>":'<td></td><td style="text-align: right;">'+a[b].votes.toLocaleString()+"</td><td></td><td></td></tr>",$("#totalstablefoot").append(f)}else if(a[b].votes>0){var g='<tr><td><div class="party-flair '+a[b].code+'"></div>'+partylist[a[b].code]+'</td><td style="text-align: right;">'+a[b].seats+"</td>";g+=simpleTables.indexOf(pageSetting)>=0?'<td style="text-align: right;">'+a[b].votes.toLocaleString()+'</td><td style="text-align: center;">'+a[b].votepercent.toFixed(2)+"</td></tr>":'<td style="text-align: right;">'+d+a[b].change+'</td><td style="text-align: right;">'+a[b].votes.toLocaleString()+'</td><td style="text-align: center;">'+a[b].votepercent.toFixed(2)+"</td><td>"+e+c+"</td></tr>",$("#totalstableinfo").append(g)}}),$("#totalstable").tablesorter({sortInitialOrder:"desc",headers:{0:{sorter:!1}},sortList:[[3,1]]})}function selectAreaInfo(a){"country"==a&&displayVoteTotals(nationalVoteTotals),"null"==a&&displayVoteTotals(nationalVoteTotals),"england"==a&&displayVoteTotals(englandVoteTotals),"scotland"==a&&displayVoteTotals(scotlandVoteTotals),"eastofengland"==a&&displayVoteTotals(eastofenglandVoteTotals),"northeastengland"==a&&displayVoteTotals(northeastenglandVoteTotals),"northwestengland"==a&&displayVoteTotals(northwestenglandVoteTotals),"southwestengland"==a&&displayVoteTotals(southwestenglandVoteTotals),"southeastengland"==a&&displayVoteTotals(southeastenglandVoteTotals),"london"==a&&displayVoteTotals(londonVoteTotals),"wales"==a&&displayVoteTotals(walesVoteTotals),"northernireland"==a&&displayVoteTotals(northernirelandVoteTotals),"yorkshireandthehumber"==a&&displayVoteTotals(yorkshireandthehumberVoteTotals),"eastmidlands"==a&&displayVoteTotals(eastmidlandsVoteTotals),"westmidlands"==a&&displayVoteTotals(westmidlandsVoteTotals),"greatbritain"==a&&displayVoteTotals(greatbritainVoteTotals)}function getVoteTotals(a){var b=[];"all"==a?b=regions.england.concat(regions.scotland).concat(regions.wales).concat(regions.northernireland):"greatbritain"==a?b=regions.england.concat(regions.scotland).concat(regions.wales):"england"==a?b=regions.england:b.push(a);var c=0,d=0;$.each(seatData,function(a){-1!=b.indexOf(seatData[a].seat_info.area)&&(c+=parseInt(seatData[a].seat_info.turnout))}),$.each(b,function(a){year=String(parseInt(pageSetting.slice(0,4))),yearRelative={2020:"2015",2016:"2015",2015:"2010",2010:"2005"},year=yearRelative[year],d+=previousTotalsByYearByParty[year][b[a]].turnout});var e=[],f=0,g=0,h=0,i=0,j=0;$.each(parties,function(a){info={};var k=parties[a];("other"==k||"others"==k)&&(k="other");var l,m=0,n=0,o=0,p=0,q=0;$.each(seatData,function(c){b.indexOf(seatData[c].seat_info.area)>-1&&(seatData[c].seat_info.winning_party==k&&(m+=1,f+=1),seatData[c].seat_info.incumbent==k&&(n+=1),parties_in_seat=Object.keys(seatData[c].party_info),-1!=parties_in_seat.indexOf(parties[a])&&(o+=seatData[c].party_info[parties[a]].total,q+=seatData[c].party_info[parties[a]].old))}),p=parseFloat((100*o/parseFloat(c)).toFixed(2)),l=parseFloat((100*q/parseFloat(d)).toFixed(2));var r=p-l;n=m-n,"other"==k?(g=m,h=n,i+=o,j+=p):(info.code=k,info.seats=m,info.change=n,info.votes=o,info.votepercent=p,info.percentchange=r,e.push(info))});var k={code:"other",seats:g,change:h,votes:i,votepercent:j},l={code:"total",seats:f-g,change:"",votes:c,votepercent:" "};e.push(k),e.push(l),alterTable(a,e)}function alterTable(a,b){"all"==a&&(nationalVoteTotals=b),"greatbritain"==a&&(greatbritainVoteTotals=b),"england"==a&&(englandVoteTotals=b),"scotland"==a&&(scotlandVoteTotals=b),"wales"==a&&(walesVoteTotals=b),"northernireland"==a&&(northernirelandVoteTotals=b),"northeastengland"==a&&(northeastenglandVoteTotals=b),"northwestengland"==a&&(northwestenglandVoteTotals=b),"westmidlands"==a&&(westmidlandsVoteTotals=b),"eastmidlands"==a&&(eastmidlandsVoteTotals=b),"yorkshireandthehumber"==a&&(yorkshireandthehumberVoteTotals=b),"eastofengland"==a&&(eastofenglandVoteTotals=b),"southeastengland"==a&&(southeastenglandVoteTotals=b),"southwestengland"==a&&(southwestenglandVoteTotals=b),"london"==a&&(londonVoteTotals=b)}var choroplethColour,partylist={};partylist.labour="Labour",partylist.conservative="Conservative",partylist.libdems="Liberal Democrats",partylist.snp="SNP",partylist.ukip="UKIP",partylist.plaidcymru="Plaid Cymru",partylist.green="Green",partylist.respect="Respect",partylist.speaker="Speaker",partylist.independent="Independent",partylist.uu="UUP",partylist.sinnfein="Sinn FÃ©in",partylist.sdlp="SDLP",partylist.dup="DUP",partylist.alliance="Alliance",partylist.other1="Other",partylist.other2="Others",partylist.other="Other",partylist.others="Others",partylist.total="Total";var regionlist={};regionlist.london="London",regionlist.southeastengland="S.E. England",regionlist.southwestengland="S. W. England",regionlist.westmidlands="W. Midlands",regionlist.northwestengland="N. W. England",regionlist.northeastengland="N. E. England",regionlist.yorkshireandthehumber="Yorks & Humber",regionlist.eastmidlands="E. Midlands",regionlist.eastofengland="E. England",regionlist.scotland="Scotland",regionlist.wales="Wales",regionlist.northernireland="N. Ireland";var pollsters={};pollsters.ashcroft="Ashcroft",pollsters.yougov="Yougov",pollsters.survation="Survation",pollsters.tns="TNS BRMB",pollsters.icm="ICM",pollsters.populus="Populus",pollsters.mori="Ipsos Mori",pollsters.opinium="Opinium",pollsters.comres="Comres",pollsters.lucidtalk="Lucidtalk",pollsters.panelbase="Panelbase",pollsters.bmg="BMG";var previousTotalsByYearByParty={2010:{eastmidlands:{alliance:0,conservative:887467,dup:0,green:13102,labour:651841,libdems:442784,other:99151,plaidcymru:0,sdlp:0,sinnfein:0,snp:0,turnout:2180460,ukip:86115,uu:0},eastofengland:{alliance:0,conservative:1342522,dup:0,green:42830,labour:557739,libdems:687838,other:83619,plaidcymru:0,sdlp:0,sinnfein:0,snp:0,turnout:2859038,ukip:144490,uu:0},london:{alliance:0,conservative:1156068,dup:0,green:54349,labour:1224041,libdems:739932,other:90628,plaidcymru:0,sdlp:0,sinnfein:0,snp:0,turnout:3325263,ukip:60245,uu:0},northeastengland:{alliance:0,conservative:272098,dup:0,green:3787,labour:506611,libdems:270641,other:69479,plaidcymru:0,sdlp:0,sinnfein:0,snp:0,turnout:1161554,ukip:38938,uu:0},northernireland:{alliance:42378,conservative:0,dup:161297,green:3542,labour:0,libdems:0,other:8772,plaidcymru:0,sdlp:109449,sinnfein:161536,snp:0,turnout:584212,ukip:0,uu:97238},northwestengland:{alliance:0,conservative:1011560,dup:0,green:18931,labour:1269322,libdems:678854,other:106561,plaidcymru:0,sdlp:0,sinnfein:0,snp:0,turnout:3202158,ukip:116930,uu:0},scotland:{alliance:0,conservative:411187,dup:0,green:0,labour:1029653,libdems:461091,other:43267,plaidcymru:0,sdlp:0,sinnfein:0,snp:494089,turnout:2456365,ukip:17078,uu:0},southeastengland:{alliance:0,conservative:2120695,dup:0,green:63082,labour:689564,libdems:1105711,other:81439,plaidcymru:0,sdlp:0,sinnfein:0,snp:0,turnout:4264256,ukip:203765,uu:0},southwestengland:{alliance:0,conservative:1187637,dup:0,green:31517,labour:426910,libdems:962954,other:40450,plaidcymru:0,sdlp:0,sinnfein:0,snp:0,turnout:2773443,ukip:123975,uu:0},wales:{alliance:0,conservative:374036,dup:0,green:6539,labour:523533,libdems:287392,other:42679,plaidcymru:165397,sdlp:0,sinnfein:0,snp:0,turnout:1435300,ukip:35724,uu:0},westmidlands:{alliance:0,conservative:1044081,dup:0,green:14996,labour:808101,libdems:540280,other:99039,plaidcymru:0,sdlp:0,sinnfein:0,snp:0,turnout:2612182,ukip:105685,uu:0},yorkshireandthehumber:{alliance:0,conservative:770659,dup:0,green:20365,labour:806799,libdems:537586,other:134549,plaidcymru:0,sdlp:0,sinnfein:0,snp:0,turnout:2342263,ukip:72305,uu:0}},2015:{eastmidlands:{alliance:0,conservative:969379,dup:0,green:66239,labour:705767,libdems:124039,other:13201,plaidcymru:0,sdlp:0,sinnfein:0,snp:0,turnout:2230402,ukip:351777,uu:0},eastofengland:{alliance:0,conservative:1445946,dup:0,green:116274,labour:649320,libdems:243191,other:15374,plaidcymru:0,sdlp:0,sinnfein:0,snp:0,turnout:2948622,ukip:478517,uu:0},london:{alliance:0,conservative:1233378,dup:0,green:171652,labour:1545110,libdems:272544,other:26626,plaidcymru:0,sdlp:0,sinnfein:0,snp:0,turnout:3536291,ukip:286981,uu:0},northeastengland:{alliance:0,conservative:300883,dup:0,
green:43051,labour:557100,libdems:77125,other:11201,plaidcymru:0,sdlp:0,sinnfein:0,snp:0,turnout:1188183,ukip:198823,uu:0},northernireland:{alliance:61556,conservative:9055,dup:184260,green:6822,labour:0,libdems:0,other:29421,plaidcymru:0,sdlp:99809,sinnfein:176232,snp:0,turnout:700414,ukip:18324,uu:114935},northwestengland:{alliance:0,conservative:1050124,dup:0,green:107889,labour:1502047,libdems:219998,other:24926,plaidcymru:0,sdlp:0,sinnfein:0,snp:0,turnout:3364055,ukip:459071,uu:0},scotland:{alliance:0,conservative:434097,dup:0,green:39205,labour:707147,libdems:219675,other:8827,plaidcymru:0,sdlp:0,sinnfein:0,snp:1454436,turnout:2910465,ukip:47078,uu:0},southeastengland:{alliance:0,conservative:2234356,dup:0,green:227883,labour:804774,libdems:413586,other:32182,plaidcymru:0,sdlp:0,sinnfein:0,snp:0,turnout:4359740,ukip:646959,uu:0},southwestengland:{alliance:0,conservative:1319967,dup:0,green:168130,labour:501684,libdems:428873,other:19873,plaidcymru:0,sdlp:0,sinnfein:0,snp:0,turnout:2823073,ukip:384546,uu:0},wales:{alliance:0,conservative:408213,dup:0,green:38344,labour:552473,libdems:97783,other:15566,plaidcymru:181694,sdlp:0,sinnfein:0,snp:0,turnout:1498433,ukip:204360,uu:0},westmidlands:{alliance:0,conservative:1098113,dup:0,green:85653,labour:865067,libdems:145009,other:22331,plaidcymru:0,sdlp:0,sinnfein:0,snp:0,turnout:2628943,ukip:412770,uu:0},yorkshireandthehumber:{alliance:0,conservative:796792,dup:0,green:86471,labour:956837,libdems:174065,other:38055,plaidcymru:0,sdlp:0,sinnfein:0,snp:0,turnout:2444143,ukip:391923,uu:0},england:{alliance:0,conservative:10448938,dup:0,green:1073242,labour:8087706,libdems:2098430,other:203769,plaidcymru:0,sdlp:0,sinnfein:0,snp:0,turnout:25523452,ukip:3611367,uu:0}}};previousTotalsByYearByParty[2005]=previousTotalsByYearByParty[2010];var regions={england:["northeastengland","northwestengland","yorkshireandthehumber","southeastengland","southwestengland","eastofengland","eastmidlands","westmidlands","london"],scotland:["scotland"],wales:["wales"],northernireland:["northernireland"]},parties=["conservative","labour","libdems","ukip","snp","plaidcymru","green","uu","sdlp","dup","sinnfein","alliance","other","others"],filteredSeatsTotal=650,pageSetting="2016parliament",seatData={},seatsAfterFilter=[],seatDataForChoropleth={},searchSeatData=[],seatNames=[],seatsFromIDs={},currentSeats=[],totalElectorate=0,swingState=["null","null"],partyVoteShare="null",partyVoteShareChange="null",isFirefox="undefined"!=typeof InstallTrigger,isIE=!1||!!document.documentMode,seatTotalContainer="#totalfilteredseats",seatListContainer="#filteredlisttable",filterStates=[{party:"null"},{gain:"null"},{region:"null"},{majoritylow:0},{majorityhigh:100}],previous_opacity,current_colour;$(function(){$("#searchseats").autocomplete({source:seatNames,select:function(a,b){searchSeats(b.item.label)}})});var currentZindex=2;loadTheMap("2016parliament");var previousSetting="2016parliament",oldPartyClass=null,oldIncumbentClass=null,partyNameElement="#information-party .party-name",partyFlairElement="#information-party .party-flair",gainNameElement="#information-gain .party-name",gainFlairElement="#information-gain .party-flair",oldSeatData={},previousYear=String(parseInt(pageSetting.slice(0,4)-5)),englandUserNumbers={conservative:0,labour:0,libdems:0,ukip:0,green:0},scotlandUserNumbers={conservative:0,labour:0,libdems:0,ukip:0,green:0,snp:0},walesUserNumbers={conservative:0,labour:0,libdems:0,ukip:0,green:0,plaidcymru:0},northernirelandUserNumbers={dup:0,sinnfein:0,sdlp:0,uu:0,alliance:0};nationalVoteTotals=[],greatbritainVoteTotals=[],englandVoteTotals=[],scotlandVoteTotals=[],walesVoteTotals=[],northernirelandVoteTotals=[],northeastenglandVoteTotals=[],northwestenglandVoteTotals=[],westmidlandsVoteTotals=[],eastmidlandsVoteTotals=[],yorkshireandthehumberVoteTotals=[],eastofenglandVoteTotals=[],southeastenglandVoteTotals=[],southwestenglandVoteTotals=[],londonVoteTotals=[];